"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a))t[a]=e[a]}return t};return __assign.apply(this,arguments)};var Moglog=function(){function t(t){this._defaultOptions={toc:"",tocIn:"replace",tocClass:"s-toc",contents:"",linkPrefix:"",header:"",htags:"h1,h2,h3,h4,h5,h6",isDebug:false,callback:null};var e=t||{};e=__assign(__assign({},this._defaultOptions),e);this.tocTarget=e.toc?e.toc:this._defaultOptions.toc;this.tocIn=e.tocIn?e.tocIn:this._defaultOptions.tocIn;this.contextTarget=e.contents?e.contents:this._defaultOptions.contents;this.anchorNamePrefix=e.linkPrefix?e.linkPrefix:this._defaultOptions.linkPrefix;this.prependHtml=e.header?e.header:this._defaultOptions.header;this.tocClassName=e.tocClass?e.tocClass:this._defaultOptions.tocClass;this.htags=e.htags?e.htags:this._defaultOptions.htags;this._isDebug=e.isDebug===true?e.isDebug:false;this._callback=typeof e.callback==="function"?e.callback:{}}t.prototype.log=function(t){if(this._isDebug)console.log("[Moglog console] "+t)};t.prototype.callback=function(t){if(typeof this._callback==="function"){this._callback(t)}};t.prototype.build=function(){var o=this;var t=document.body.querySelector(this.tocTarget);if(!t){this.log("toc target not found");this.callback(false);return false}var e=document.createElement("div");e.setAttribute("class",this.tocClassName);if(this.tocIn=="prepend"){this.prependEl(t,e)}else if(this.tocIn=="append"){this.appendEl(t,e)}else{t.innerHTML="";this.appendEl(t,e)}if(this._isDebug)e.innerHTML="...";var n;var i=document.body.querySelector(this.contextTarget);if(i!=null){n=i.querySelectorAll(this.htags)}else{this.log("context target not found");this.callback(false);return false}var l=[];Array.prototype.forEach.call(n,function(t,e){var n=t.tagName;var i=t.innerText;var a=o.anchorNamePrefix+i+"-"+e;var s=document.createElement("span");s.setAttribute("id",a);o.prependEl(t,s);var r={name:a,section:e+1,level:parseInt(n.slice(-1)),text:i};l.push(r)});e.innerHTML=this.prependHtml+this.buildTocString(l);this.callback(l)};t.prototype.buildTocString=function(t){var s=this;var r=[0,0,0,0,0,0,0,0,0];var o=1;var l="";t.forEach(function(t,e){var n=t.level;if(o>n){r.forEach(function(t,e){if(e>n){r[e]=0}})}r[n]++;var i="";r.forEach(function(t,e){if(e<=n&&e!=0){i+=t+"."}});var a='<a href="#'+t.name+'"><span class="tocnumber">'+i+'</span> <span class="toctext">'+t.text+"</span></a>";if(o<n){a="<ul><li>"+a}else if(o>n){a="</li>"+s.repeatString("</ul>",o-n)+("<li>"+a)}else if(e==0){a="<li>"+a}else{a="</li><li>"+a}l+=a;o=n});if(t.length>0){l="<ul>"+l+"</ul>"}return l};t.prototype.repeatString=function(t,e){if(!String.prototype.repeat){var n="";while(e>0){n+=t;e--}return n}else{return t.repeat(e)}};t.prototype.appendEl=function(t,e){t.insertAdjacentElement("beforeend",e)};t.prototype.prependEl=function(t,e){t.insertAdjacentElement("afterbegin",e)};return t}();